<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Population Graph</title>
    <link rel="shortcut icon" href="../images/icon.png" type="image/x-icon">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="../css/graph.css">
</head>
<body>
    <h1>State Population Graph</h1>
    <button id="generateGraph">Generate Graph</button><br><br><br>
    <canvas id="myChart" width="auto" height="100%" style="display: none;"></canvas>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            console.log("Document loaded, waiting for button click...");

            document.getElementById("generateGraph").addEventListener("click", function() {
                console.log("Button clicked, fetching data...");
                fetchDataAndCreateChart();
            });

            function fetchDataAndCreateChart() {
                fetch("/IndiaProject/population.csv") // Replace with actual CSV file path
                    .then(response => response.text())
                    .then(data => {
                        console.log("CSV file loaded successfully!");
                        const rows = data.split("\n").slice(1);
                        let labels = [], values = [];

                        rows.forEach(row => {
                            let [state, population] = row.split(",");
                            labels.push(state);
                            values.push(parseInt(population, 10));
                        });

                        console.log("Final Labels:", labels);
                        console.log("Final Values:", values);

                        let ctx = document.getElementById("myChart").getContext("2d");

                        // Destroy previous chart if it exists
                        if (window.myChart instanceof Chart) {
                            window.myChart.destroy();
                        }

                        // Create new chart
                        window.myChart = new Chart(ctx, {
                            type: "bar",
                            data: {
                                labels: labels,
                                datasets: [{
                                    label: "Population",
                                    data: values,
                                    backgroundColor: "rgba(54, 162, 235, 0.5)",
                                    borderColor: "rgba(54, 162, 235, 1)",
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                responsive: true,
                                scales: {
                                    y: { beginAtZero: true }
                                }
                            }
                        });

                        console.log("Chart successfully created!");
                    })
                    .catch(error => console.error("Error loading CSV data:", error));
            }
        });
    </script>


</body>
</html>
